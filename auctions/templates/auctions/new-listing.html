{% extends "auctions/layout.html" %}
{% load widget_tweaks %}

{% block body %}
<h2>Create Listing</h2>

<form method="post" novalidate>
    {% csrf_token %}
    
    {% for field in form %}
        <div class="form-group row {% if field.errors %} has-error {% endif %}">
            <label for="{{ field.id_for_label }}" class="col-sm-2 col-form-label">{{ field.label }}</label>
            <div class="col-sm-10">
                {% if field.name == 'starting_bid' %}
                    <div class="input-group mb-3">
                        <span class="input-group-text mr-2" id="inputGroup-sizing-default">$</span>
                {% endif %}
                {% if form.is_bound %}
                    {% if field.errors %}
                        {{ field | add_class:"is-invalid" }}
                        {% for error in field.errors %}
                            <div class="invalid-feedback">
                                {{ error }}
                            </div>
                        {% endfor %}
                    {% elif field.name not in '["image_URL", "category"]' %}
                        {{ field | add_class:"is-valid" }}
                    {% else %}
                        {{ field }}
                    {% endif %}
                {% else %}
                    {{ field }}
                {% endif %}
                
                {% if field.name == 'starting_bid' %}</div>{% endif %}
                
                {% if field.name == 'image_URL' %}
                    <img id="img-preview-{{ field.id_for_label }}" src="#" alt="Image Preview" style="display:none; max-width:200px; margin-top:10px;">
                    <script>
                        // Bind image preview to image_URL input field
                        var imgPreview = document.getElementById("img-preview-{{ field.id_for_label }}");
                        var imageInput = document.getElementById("{{ field.id_for_label }}");

                        imageInput.addEventListener("input", function () {
                            imgPreview.style.display = "block";
                            imgPreview.src = imageInput.value;
                        });
                    </script>
                {% endif %}
            </div>
        </div>
    {% endfor %}
    <button type="submit" class="btn btn-primary btn-block">Create</button>
</form>

{% endblock %}
